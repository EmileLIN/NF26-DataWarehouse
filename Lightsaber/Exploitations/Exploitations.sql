--Question 01  Fait en fonction du mois de l'annee

--Qte vendu
SELECT d.month, COUNT(*) AS Qte
FROM f_dw_vente v, f_dw_date d
WHERE v.Trade_date = d.Trade_date
GROUP BY d.month;

--Chiffre d'affaire
SELECT d.month, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_date d, f_dw_product p 
WHERE v.Trade_date = d.Trade_date AND v.product = p.product_id
GROUP BY d.month;


--Question 02 Fait en fonction des annee

--Qte vendu
SELECT d.year, COUNT(*) AS Qte
FROM f_dw_vente v, f_dw_date d
WHERE v.Trade_date = d.Trade_date
GROUP BY d.year;

--Chiffre d'affaire
SELECT d.year, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_date d, f_dw_product p 
WHERE v.Trade_date = d.Trade_date AND v.product = p.product_id
GROUP BY d.year;

--Question 03 Fait en fonction de la semaine 

--Qte vendu
SELECT d.weeknumber, COUNT(*) AS Qte
FROM f_dw_vente v, f_dw_date d
WHERE v.Trade_date = d.Trade_date
GROUP BY d.weeknumber;

--Chiffre d'affaire
SELECT d.weeknumber, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_date d, f_dw_product p 
WHERE v.Trade_date = d.Trade_date AND v.product = p.product_id
GROUP BY d.weeknumber;


--Qustion 04 Fait en fonction de jour de la semaine

--Qte vendu
SELECT d.jds, COUNT(*) AS Qte
FROM f_dw_vente v, f_dw_date d
WHERE v.Trade_date = d.Trade_date
GROUP BY d.jds;

--Chiffre d'affaire
SELECT d.jds, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_date d, f_dw_product p 
WHERE v.Trade_date = d.Trade_date AND v.product = p.product_id
GROUP BY d.jds;


--Question 05 Fait en fonction de l'age des produits

--Qte vendu
SELECT p.AgeOfDesign, COUNT(*)
FROM f_dw_vente v, f_dw_product p
WHERE v.product = p.product_id
GROUP BY p.AgeOfDesign;

--Chiffre d'affaire
SELECT p.AgeOfDesign, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_product p
WHERE v.product = p.product_id
GROUP BY p.AgeOfDesign;


--Qustion 06 Fait par rapport a la taille du produit

--Qte vendu
SELECT p.Product_size, COUNT(*)
FROM f_dw_vente v, f_dw_product p
WHERE v.product = p.product_id
GROUP BY p.Product_size;

--Chiffre d'affaire
SELECT p.Product_size, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_product p
WHERE v.product = p.product_id
GROUP BY p.Product_size;


--Question 07 Faits par rapport aux prix des produits

CREATE OR REPLACE VIEW price_view(Pro_Id,Price,Price_rank)
AS
	SELECT product_id AS Pro_Id,price,
	CASE 
		WHEN price >= 0 AND price <= 400 THEN 'less than 400'
		WHEN price > 400 AND price <= 800 THEN 'between 400 and 800'
		WHEN price > 800 AND price <= 1200 THEN 'between 800 and 1200'
		WHEN price >1200 THEN 'more than 1200'
  END
	AS prix
	FROM f_dw_product;


--Qte vendu
SELECT p.price_rank, COUNT(*)
FROM f_dw_vente v, price_view p
WHERE v.product = p.Pro_Id
GROUP BY p.price_rank;

--Chiffre d'affaire
SELECT p.price_rank, SUM(p.price) AS Chiffre
FROM f_dw_vente v, price_view p
WHERE v.product = p.Pro_Id
GROUP BY p.price_rank;


--Question 08 Les performance en fonction de designer

--Qte vendu
SELECT p.designer, COUNT(*)
FROM f_dw_vente v, f_dw_product p
WHERE v.product = p.product_id
GROUP BY p.designer;

--Chiffre d'affaire
SELECT p.designer, SUM(p.price) AS Chiffre
FROM f_dw_vente v, f_dw_product p
WHERE v.product = p.product_id
GROUP BY p.designer;


--Question 09 Fait par rapport au poids des produits
SELECT DISTINCT weight FROM f_dw_product;

CREATE OR REPLACE VIEW weight_view(Pro_Id,weight,weight_range)
AS
	SELECT product_id AS Pro_Id,weight,
	CASE 
		WHEN weight >= 0 AND weight <= 500 THEN 'less than 500'
		WHEN weight > 500 AND weight <= 1000 THEN 'between 500 and 1000'
		WHEN weight > 1000 AND weight <= 1500 THEN 'between 1000 and 1500'
		WHEN weight > 1500  AND weight <= 2000 THEN 'between 1500 and 2000'
		WHEN weight > 2000  AND weight <= 2500 THEN 'between 2000 and 2500'
		WHEN weight > 2500  AND weight <= 3000 THEN 'between 2500 and 3000'
		WHEN weight > 3000 THEN 'bigger than 3000'
  	END
	AS weight
	FROM f_dw_product;


--Qte vendu
SELECT p.weight_range, COUNT(*)
FROM f_dw_vente v, weight_view p
WHERE v.product = p.Pro_Id
GROUP BY p.weight_range;

--Chiffre d'affaire
SELECT p.weight_range, SUM(p.weight) AS Chiffre
FROM f_dw_vente v, weight_view p
WHERE v.product = p.Pro_Id
GROUP BY p.weight_range;


--Question 10 Fait en fonction du genre du client

--Qte vendu
SELECT c.Gender, COUNT(*)
FROM f_dw_vente v, f_dw_customer c 
WHERE v.Customer_Num = c.Customer_Num
GROUP BY c.Gender;

--Chiffre d'affaire
SELECT c.Gender, SUM(p.price)
FROM f_dw_vente v, f_dw_customer c,f_dw_product p 
WHERE v.Customer_Num = c.Customer_Num AND v.product = p.product_id
GROUP BY c.Gender;


--Question 11 Fait en fonction des revenus du client 

SELECT DISTINCT Income FROM f_dw_customer;

--Qte vendu
SELECT c.Income, COUNT(*)
FROM f_dw_vente v, f_dw_customer c 
WHERE v.Customer_Num = c.Customer_Num
GROUP BY c.Income;

--Chiffre d'affaire
SELECT c.Income, SUM(p.price)
FROM f_dw_vente v, f_dw_customer c,f_dw_product p 
WHERE v.Customer_Num = c.Customer_Num AND v.product = p.product_id
GROUP BY c.Income;

--Question 12 Fait par rapport a l'age des clients

SELECT DISTINCT Age FROM f_dw_customer;

CREATE OR REPLACE VIEW AGE_VIEW(Cus_Id,age_range)
AS 
	SELECT Customer_Num,
	CASE
	  WHEN age >=0 AND age < 20 THEN 'less than 20 '
	  WHEN age >=20 AND age < 40 THEN 'between 20 et 40'
	  WHEN age >=40 AND age < 60 THEN 'between 40 et 60'
	  WHEN age >=60 AND age < 80 THEN 'between 60 et 80'
	  WHEN age >=80  THEN 'more than 80 '
	END
	FROM f_dw_customer;

SELECT a.age_range,COUNT(*)
FROM f_dw_vente v,AGE_VIEW a 
WHERE v.Customer_Num = a.Cus_Id
GROUP BY a.age_range;

SELECT a.age_range,SUM(p.price)
FROM f_dw_vente v,AGE_VIEW a,f_dw_product p 
WHERE v.Customer_Num = a.Cus_Id AND v.product = p.product_id
GROUP BY a.age_range;


--Question 13 Vente en fonction de niveau du client
SELECT c.Customer_level,COUNT(*)
FROM f_dw_vente v,f_dw_customer c 
WHERE v.Customer_Num = c.Customer_Num
GROUP BY c.Customer_level;

--Question 14 Vente en fonction de la capacite usine
SELECT f.capacity, COUNT(*)
FROM f_dw_vente v, f_dw_factory f
WHERE v.factory = f.factory_num
GROUP BY f.capacity;

--Question 15 
SELECT DISTINCT ageoffactory  FROM f_dw_factory;

CREATE OR REPLACE VIEW AGE_FACTORY(Fac_Id,age_range)
AS 
	SELECT factory_num,
	CASE
	  WHEN ageoffactory >=0 AND ageoffactory < 20 THEN 'less than 20 '
	  WHEN ageoffactory >=20 AND ageoffactory < 40 THEN 'between 20 et 40'
	  WHEN ageoffactory >=40 AND ageoffactory < 60 THEN 'between 40 et 60'
	  WHEN ageoffactory >=60 AND ageoffactory < 80 THEN 'between 60 et 80'
	  WHEN ageoffactory >=80  THEN 'more than 80 '
	END
	FROM f_dw_factory;

SELECT a.age_range, COUNT(*)
FROM f_dw_vente v, AGE_FACTORY a
WHERE v.factory = a.fac_id
GROUP BY a.age_range;























