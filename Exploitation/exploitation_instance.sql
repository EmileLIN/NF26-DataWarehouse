--Example Questions

--Q1 In which day of a week we sell le most of book?

SELECT DISTINCT JDS FROM F_DW_DATE;

SELECT d.JDS, count(*) AS Qte
FROM f_dw_vente v,f_dw_date d
WHERE v.TICKET_DATE = d.TRADE_DATE
GROUP BY d.JDS
ORDER BY Qte DESC;

--Q2 In which departement we sell the most of book?

SELECT m.DPT_NAME, COUNT(*) AS Qte
FROM f_dw_vente v,f_dw_magasin m
WHERE v.SHOP = m.MAGASIN_ID
GROUP BY m.DPT_NAME
ORDER BY Qte DESC;

--Q3 We try about an action ROLLUP

SELECT d.TRIMESTRE,d.MOIS,count(*) AS Qte
FROM f_dw_vente v,f_dw_date d
WHERE v.TICKET_DATE = d.TRADE_DATE
GROUP BY ROLLUP (d.TRIMESTRE,d.MOIS);

--Q4 We try about an action cube

SELECT m.BESTSELLER,p.AUTEUR,count(*) AS Qte
FROM f_dw_vente v,f_dw_magasin m ,f_dw_catalogue p
WHERE v.SHOP = m.MAGASIN_ID AND v.PRODUCT = p.ISBN
GROUP BY CUBE(m.BESTSELLER,p.AUTEUR);

--Q5 RANK
-- TOP 100 best selled books
SELECT * FROM
(
	SELECT p.ISBN AS ISBN, COUNT(*) AS vente, RANK() OVER(ORDER BY COUNT(*) DESC) AS rank
	FROM f_dw_vente v,f_dw_catalogue p 
	WHERE p.ISBN = v.PRODUCT
	GROUP BY p.ISBN
)
WHERE rank <= 100;

--Q6 Totaux cumule
--Sum up the sell transactions by weeks

SELECT d.SEMAINE, SUM(COUNT(*)) OVER (ORDER BY d.SEMAINE ROWS UNBOUNDED PRECEDING)
FROM  f_dw_vente v,f_dw_date d
WHERE v.TICKET_DATE = d.TRADE_DATE
GROUP BY d.SEMAINE;
































